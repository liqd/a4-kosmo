#!/bin/sh

set -e -v

if [ -n ${TRAVIS_SSH_SECRET} ]; then
    SSH_ID_ARG="-i ${HOME}/id_rsa"
    cat <<EOF | openssl enc -d -pass env:TRAVIS_SSH_SECRET -aes256 -a -out ~/id_rsa
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
ttFVIH34SoGKh/+YRNB8pg==
EOF
    chmod 600 ~/id_rsa
fi

ssh ${SSH_ID_ARG} -oStrictHostKeyChecking=no build@conway.liqd.net deploy liqd_product master
